<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Upgrade and migrate procedures while OpenDAL meets breaking changes."><title>opendal::docs::upgrade - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="opendal" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../../../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../opendal/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../opendal/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module upgrade</a></h2><div class="sidebar-elems"></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">opendal</a>::<wbr><a href="../index.html">docs</a>::<wbr><a class="mod" href="#">upgrade</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/opendal/docs/mod.rs.html#44">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Upgrade and migrate procedures while OpenDAL meets breaking changes.</p>
<h2 id="upgrade-to-v037"><a href="#upgrade-to-v037">Upgrade to v0.37</a></h2>
<p>In v0.37.0, OpenDAL bump the version of <code>reqsign</code> to v0.13.0.</p>
<p>There are no public API and raw API changes.</p>
<h2 id="upgrade-to-v036"><a href="#upgrade-to-v036">Upgrade to v0.36</a></h2><h3 id="public-api"><a href="#public-api">Public API</a></h3>
<p>In v0.36, OpenDAL improving the <code>xxx_with</code> API by allow it to be called in chain:</p>
<p>After this change, all <code>xxx_with</code> alike call will be changed from</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>bs = op.read_with(
  <span class="string">&quot;path/to/file&quot;</span>,
  OpRead::new()
    .with_range(<span class="number">0</span>..=<span class="number">1024</span>)
    .with_if_match(<span class="string">&quot;&lt;etag&gt;&quot;</span>)
    .with_if_none_match(<span class="string">&quot;&lt;etag&gt;&quot;</span>)
    .with_override_cache_control(<span class="string">&quot;&lt;cache_control&gt;&quot;</span>)
    .with_override_content_disposition(<span class="string">&quot;&lt;content_disposition&gt;&quot;</span>)
  ).<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<p>to</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>bs = op.read_with(<span class="string">&quot;path/to/file&quot;</span>)
  .range(<span class="number">0</span>..=<span class="number">1024</span>)
  .if_match(<span class="string">&quot;&lt;etag&gt;&quot;</span>)
  .if_none_match(<span class="string">&quot;&lt;etag&gt;&quot;</span>)
  .override_cache_control(<span class="string">&quot;&lt;cache_control&gt;&quot;</span>)
  .override_content_disposition(<span class="string">&quot;&lt;content_disposition&gt;&quot;</span>)
  .<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<p>For blocking API calls, we will need a <code>call()</code> at the end:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>bs = bop.read_with(<span class="string">&quot;path/to/file&quot;</span>)
  .range(<span class="number">0</span>..=<span class="number">1024</span>)
  .if_match(<span class="string">&quot;&lt;etag&gt;&quot;</span>)
  .if_none_match(<span class="string">&quot;&lt;etag&gt;&quot;</span>)
  .override_cache_control(<span class="string">&quot;&lt;cache_control&gt;&quot;</span>)
  .override_content_disposition(<span class="string">&quot;&lt;content_disposition&gt;&quot;</span>)
  .call()<span class="question-mark">?</span>;</code></pre></div>
<p>Along with this change, users don’t need to call <code>OpXxx</code> anymore so we moved it to <code>raw</code> API.</p>
<p>More detailes could be found at <a href="../rfcs/rfc_2299_chain_based_operator_api/index.html" title="mod opendal::docs::rfcs::rfc_2299_chain_based_operator_api">RFC: Chain Based Operator API</a>.</p>
<h3 id="raw-api"><a href="#raw-api">Raw API</a></h3>
<p>Migrated <code>opendal::ops</code> to <code>opendal::raw::ops</code>.</p>
<h2 id="upgrade-to-v035"><a href="#upgrade-to-v035">Upgrade to v0.35</a></h2><h3 id="public-api-1"><a href="#public-api-1">Public API</a></h3>
<ul>
<li>OpenDAL removes rarely used <code>Operator::from_env</code> and <code>Operator::from_iter</code> APIs
<ul>
<li>Users can use <code>Operator::via_map</code> instead.</li>
</ul>
</li>
</ul>
<h3 id="raw-api-1"><a href="#raw-api-1">Raw API</a></h3>
<ul>
<li>OpenDAL adds <code>append</code> support with could break existing layers. Please make sure <code>append</code> requests have been forward correctly.</li>
<li>After the merging of <code>scan</code> and <code>list</code>, OpenDAL removes the <code>scan</code> from raw API. Please use <code>list_without_delimiter</code> instead.</li>
</ul>
<h2 id="upgrade-to-v034"><a href="#upgrade-to-v034">Upgrade to v0.34</a></h2><h3 id="public-api-2"><a href="#public-api-2">Public API</a></h3>
<ul>
<li>OpenDAL raises it’s MSRV to 1.65 for dependences changes</li>
<li><code>OperatorInfo::can_scan</code> has been removed, to check if underlying services support scan a dir natively, please use <code>Capability::list_without_delimiter</code> instead.</li>
</ul>
<h3 id="raw-api-2"><a href="#raw-api-2">Raw API</a></h3><h4 id="merged-scan-into-list"><a href="#merged-scan-into-list">Merged <code>scan</code> into <code>list</code></a></h4>
<p>After <code>Capability</code> introduced, we have added <code>delimiter</code> in <code>OpList</code>. Users can specify the delimiter to <code>&quot;&quot;</code> or <code>&quot;/&quot;</code> to control the list behavior.</p>
<p>Along with this change, <code>Operator::scan()</code> becomes a short alias of <code>Operator::list_with(OpList::new().with_delimiter(&quot;&quot;))</code>.</p>
<h4 id="typed-kv-adapter"><a href="#typed-kv-adapter">Typed Kv Adapter</a></h4>
<p>In v0.34, OpenDAL adds a typed kv adapter for zero-copy read and write. If you are implemented kv adapter for a rust in-memory data struct, please consider migrate.</p>
<h2 id="upgrade-to-v033"><a href="#upgrade-to-v033">Upgrade to v0.33</a></h2><h3 id="public-api-3"><a href="#public-api-3">Public API</a></h3>
<p>OpenDAL 0.33 has redesigned the <code>Writer</code> API, replacing all instances of <code>writer.append()</code> with <code>writer.write()</code>. For more information, please refer to <a href="../../struct.Writer.html" title="struct opendal::Writer"><code>Writer</code></a>.</p>
<h3 id="raw-api-3"><a href="#raw-api-3">Raw API</a></h3>
<p>In addition to the redesign of the <code>Writer</code> API, we have removed <code>append</code> from <code>oio::Write</code>. Therefore, users who implement services and layers should also remove it.</p>
<p>After v0.33 landing, services should handle <code>OpWrite::content_length</code> correctly by following these guidelines:</p>
<ul>
<li>If the writer does not support uploading unsized data, return a response of <code>NotSupported</code> if content length is <code>None</code>.</li>
<li>Otherwise, continue writing data until either <code>close</code> or <code>abort</code> has been called.</li>
</ul>
<p>Furthermore, OpenDAL 0.33 introduces a new concept called <code>Capability</code> which replaces <code>AccessorCapability</code>. Services must adapt to this change.</p>
<h2 id="upgrade-to-v032"><a href="#upgrade-to-v032">Upgrade to v0.32</a></h2>
<p>OpenDAL 0.32 doesn’t have much breaking changes.</p>
<p>We changed <code>Accessor::create</code> into <code>Accessor::create_dir</code>. Only users who implement <code>Layer</code> need to change.</p>
<h2 id="upgrade-to-v031"><a href="#upgrade-to-v031">Upgrade to v0.31</a></h2>
<p>In version v0.31 of OpenDAL, we made some internal refactoring to improve its compatibility with the ecosystem.</p>
<h3 id="msrv-bump"><a href="#msrv-bump">MSRV Bump</a></h3>
<p>We increased the MSRV to 1.64 from v0.31 onwards. Although it is still possible to build OpenDAL under older rustc versions, we cannot guarantee that any issues related to them will be fixed.</p>
<h3 id="accept-stdtimeduration-instead"><a href="#accept-stdtimeduration-instead">Accept <code>std::time::Duration</code> instead</a></h3>
<p>Previously, OpenDAL accepted <code>time::Duration</code> as input for <code>presign_xxx</code>. However, since v0.31, we have changed this to accept <code>std::time::Duration</code> so that users do not need to depend on <code>time</code>. Internally, we migrated from <code>time</code> to <code>chrono</code> for better integration with other parts of the ecosystem.</p>
<h3 id="disable_ec2_metadata-for-services-s3"><a href="#disable_ec2_metadata-for-services-s3"><code>disable_ec2_metadata</code> for services s3</a></h3>
<p>We have added a new configuration option called <code>disable_ec2_metadata</code> for the S3 service in response to a mistake where it was mixed up with another option called <code>disable_config_load</code>. Users who want to disable loading credentials from EC2 metadata should set this option instead.</p>
<h3 id="services-feature-flag"><a href="#services-feature-flag">Services Feature Flag</a></h3>
<p>Starting from v0.31, all services in OpenDAL are split into different feature flags. To enable only S3 support, use the following TOML configuration:</p>
<div class="example-wrap"><pre class="language-toml"><code>opendal = {
    version = &quot;0.31&quot;,
    default-features = false,
    features = [&quot;services-s3&quot;]
}
</code></pre></div><h2 id="upgrade-to-v030"><a href="#upgrade-to-v030">Upgrade to v0.30</a></h2>
<p>In version 0.30, we made significant breaking changes by removing objects. Our goal in doing so was to provide our users with APIs that are easier to understand and maintain.</p>
<p>More detailes could be found at <a href="../rfcs/rfc_1477_remove_object_concept/index.html" title="mod opendal::docs::rfcs::rfc_1477_remove_object_concept">RFC: Remove Object Concept</a>.</p>
<p>To upgrade to OpenDAL v0.30, users need to make the following changes:</p>
<ul>
<li>regex replace <code>object\((.*)\).reader\(\)</code> to <code>reader($1)</code>
<ul>
<li>replace the function on your case, it’s recomanded to do it one by one</li>
</ul>
</li>
<li>rename <code>ObjectMetakey</code> =&gt; <code>Metakey</code></li>
<li>rename <code>ObjectMode</code> =&gt; <code>EntryMode</code></li>
<li>replace <code>ErrorKind::ObjectXxx</code> to <code>ErrorKind::Xxx</code></li>
<li>rename <code>AccessorMetadata</code> =&gt; <code>AccessorInfo</code></li>
<li>rename <code>ObjectMetadata</code> =&gt; <code>Metadata</code></li>
<li>replace <code>operator.metadata()</code> =&gt; <code>operator.info()</code></li>
</ul>
<h2 id="upgrade-to-v029"><a href="#upgrade-to-v029">Upgrade to v0.29</a></h2>
<p>In v0.29, we introduced <a href="../rfcs/rfc_1420_object_writer/index.html" title="mod opendal::docs::rfcs::rfc_1420_object_writer">Object Writer</a> to replace existing Multipart related APIs.</p>
<p>Users can now append multiparts bytes into object via:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span><span class="kw-2">mut </span>w = o.writer().<span class="kw">await</span><span class="question-mark">?</span>;
w.write(bs1).<span class="kw">await</span><span class="question-mark">?</span>;
w.write(bs2).<span class="kw">await</span><span class="question-mark">?</span>;
w.close()</code></pre></div>
<p>Along with this change, we cleaned up a lot of internal structs and traits. Users who used to depend on <code>opendal::raw::io::{input,output}</code> should use <code>opendal::raw::oio</code> instead.</p>
<p>Also, decompress related feature also removed. Users can use <code>async-compression</code> with <code>ObjectReader</code> directly.</p>
<h2 id="upgrade-to-v028"><a href="#upgrade-to-v028">Upgrade to v0.28</a></h2>
<p>In v0.28, we introduced <a href="../rfcs/rfc_1398_query_based_metadata/index.html" title="mod opendal::docs::rfcs::rfc_1398_query_based_metadata">Query Based Metadata</a>. Users can query cached metadata with <code>ObjectMetakey</code> to make sure that OpenDAL always makes the best decision.</p>
<div class="example-wrap"><pre class="language-diff"><code>- pub async fn metadata(&amp;self) -&gt; Result&lt;ObjectMetadata&gt;;
+ pub async fn metadata(
+        &amp;self,
+        flags: impl Into&lt;FlagSet&lt;ObjectMetakey&gt;&gt;,
+    ) -&gt; Result&lt;Arc&lt;ObjectMetadata&gt;&gt;;
</code></pre></div>
<p>Please visit <code>Object::metadata()</code>’s example for more details.</p>
<h2 id="upgrade-to-v027"><a href="#upgrade-to-v027">Upgrade to v0.27</a></h2>
<p>In v0.27, we refactored our <code>list</code> related logic and added <code>scan</code> support. So make <code>Pager</code> and <code>BlockingPager</code> associated types in <code>Accessor</code> too!</p>
<div class="example-wrap"><pre class="language-diff"><code>pub trait Accessor: Send + Sync + Debug + Unpin + &#39;static {
    type Reader: output::Read;
    type BlockingReader: output::BlockingRead;
+    type Pager: output::Page;
+    type BlockingPager: output::BlockingPage;
}
</code></pre></div><h3 id="user-defined-layers"><a href="#user-defined-layers">User defined layers</a></h3>
<p>Due to this change, all layers implementation should be changed. If there is not changed over pager, they can by changed like the following:</p>
<div class="example-wrap"><pre class="language-diff"><code>impl&lt;A: Accessor&gt; LayeredAccessor for MyAccessor&lt;A&gt; {
    type Inner = A;
    type Reader = MyReader&lt;A::Reader&gt;;
    type BlockingReader = MyReader&lt;A::BlockingReader&gt;;
+    type Pager = A::Pager;
+    type BlockingPager = A::BlockingPager;

+    async fn list(&amp;self, path: &amp;str, args: OpList) -&gt; Result&lt;(RpList, Self::Pager)&gt; {
+        self.inner.list(path, args).await
+    }

+    async fn scan(&amp;self, path: &amp;str, args: OpScan) -&gt; Result&lt;(RpScan, Self::Pager)&gt; {
+        self.inner.scan(path, args).await
+    }

+    fn blocking_list(&amp;self, path: &amp;str, args: OpList) -&gt; Result&lt;(RpList, Self::BlockingPager)&gt; {
+        self.inner.blocking_list(path, args)
+    }

+    fn blocking_scan(&amp;self, path: &amp;str, args: OpScan) -&gt; Result&lt;(RpScan, Self::BlockingPager)&gt; {
+        self.inner.blocking_scan(path, args)
+    }
}
</code></pre></div><h3 id="usage-of-ops"><a href="#usage-of-ops">Usage of ops</a></h3>
<p>To reduce the understanding overhead, we move all <code>OpXxx</code> into <code>opendal::ops</code> now. User may need to change:</p>
<div class="example-wrap"><pre class="language-diff"><code>- use opendal::OpWrite;
+ use opendal::ops::OpWrite;
</code></pre></div><h3 id="usage-of-retrylayer"><a href="#usage-of-retrylayer">Usage of RetryLayer</a></h3>
<p><code>backon</code> is the implementation detail of our <code>RetryLayer</code>, so we hide it from our public API. Users of <code>RetryLayer</code> need to change the code like:</p>
<div class="example-wrap"><pre class="language-diff"><code>- RetryLayer::new(backon::ExponentialBackoff::default())
+ RetryLayer::new()
</code></pre></div><h2 id="upgrade-to-v026"><a href="#upgrade-to-v026">Upgrade to v0.26</a></h2>
<p>In v0.26 we have replaced all internal dynamic dispatch usage with static dispatch. With this change, we can ensure that all operations performed inside OpenDAL are zero cost.</p>
<p>Due to this change, we have to refactor the logic of <code>Operator</code>’s init logic. In v0.26, we added <code>opendal::Builder</code> trait and <code>opendal::OperatorBuilder</code>. For the first glance, the only change to existing code will be like:</p>
<div class="example-wrap"><pre class="language-diff"><code>- let op = Operator::new(builder.build()?);
+ let op = Operator::new(builder.build()?).finish();
</code></pre></div>
<p>By adding a <code>finish()</code> call, we will erase all generic types so that <code>Operator</code> can still be easily to used everywhere as before.</p>
<h3 id="accessor"><a href="#accessor">Accessor</a></h3>
<p>In v0.26, <code>Accessor</code> has been changed into trait with associated types.</p>
<p>All services need to declare the types returned as <code>Reader</code> or <code>BlockingReader</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub trait </span>Accessor: Send + Sync + Debug + Unpin + <span class="lifetime">&#39;static </span>{
    <span class="kw">type </span>Reader: output::Read;
    <span class="kw">type </span>BlockingReader: output::BlockingRead;
}</code></pre></div>
<p>If your service doesn’t support <code>read</code> or <code>blocking_read</code>, we can use <code>()</code> to represent an dummy reader:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>Accessor <span class="kw">for </span>MyDummyAccessor {
    <span class="kw">type </span>Reader = ();
    <span class="kw">type </span>BlockingReader = ();
}</code></pre></div>
<h3 id="layer"><a href="#layer">Layer</a></h3>
<p>As described before, OpenDAL prefer to use static dispatch. Layers are required to implement the new <code>Layer</code> and <code>LayeredAccessor</code> trait:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub trait </span>Layer&lt;A: Accessor&gt; {
    <span class="kw">type </span>LayeredAccessor: Accessor;

    <span class="kw">fn </span>layer(<span class="kw-2">&amp;</span><span class="self">self</span>, inner: A) -&gt; <span class="self">Self</span>::LayeredAccessor;
}

<span class="attr">#[async_trait]
</span><span class="kw">pub trait </span>LayeredAccessor: Send + Sync + Debug + Unpin + <span class="lifetime">&#39;static </span>{
    <span class="kw">type </span>Inner: Accessor;
    <span class="kw">type </span>Reader: output::Read;
    <span class="kw">type </span>BlockingReader: output::BlockingRead;
}</code></pre></div>
<p><code>LayeredAccessor</code> is a wrapper of <code>Accessor</code> with the typed <code>Innder</code>. All methods that not implemented will be forward to inner instead.</p>
<h3 id="builder"><a href="#builder">Builder</a></h3>
<p>Since v0.26, we implement <code>opendal::Builder</code> for all services, and services’ mod will not be exported.</p>
<div class="example-wrap"><pre class="language-diff"><code>- use opendal::services::s3::Builder;
+ use opendal::services::S3;
</code></pre></div><h3 id="conclusion"><a href="#conclusion">Conclusion</a></h3>
<p>Sorry again for the big changes in this release. It’s a big step for OpenDAL to work in more critical systems.</p>
<h2 id="upgrade-to-v025"><a href="#upgrade-to-v025">Upgrade to v0.25</a></h2>
<p>In v0.25, we bring the same feature sets from <code>ObjectReader</code> to <code>BlockingObjectReader</code>.</p>
<p>Due to this change, all code that depends on <code>BlockingBytesReader</code> should be refactored.</p>
<ul>
<li><code>BlockingBytesReader</code> =&gt; <code>input::BlockingReader</code></li>
<li><code>BlockingOutputBytesReader</code> =&gt; <code>output::BlockingReader</code></li>
</ul>
<p>Most changes only happen inside. Users not using <code>opendal::raw::*</code> will not be affected.</p>
<p>Apart from this change, we refactored s3 credential loading logic. After this change, we can disable the config load instead of the credential methods.</p>
<ul>
<li><code>builder.disable_credential_loader</code> =&gt; <code>builder.disable_config_load</code></li>
</ul>
<h2 id="upgrade-to-v024"><a href="#upgrade-to-v024">Upgrade to v0.24</a></h2>
<p>In v0.24, we made a big refactor on our internal IO-related traits. In this version, we split our IO traits into <code>input</code> and <code>output</code> versions:</p>
<p>Take <code>Reader</code> as an example:</p>
<p><code>input::Reader</code> is the user input reader, which only requires <code>futures::AsyncRead + Send</code>.</p>
<p><code>output::Reader</code> is the reader returned by <code>OpenDAL</code>, which implements <code>futures::AsyncRead</code>, <code>futures::AsyncSeek</code>, and <code>futures::Stream&lt;Item=io::Result&lt;Bytes&gt;&gt;</code>. Besides, <code>output::Reader</code> also implements <code>Send + Sync</code>, which makes it useful for users.</p>
<p>Due to this change, all code that depends on <code>BytesReader</code> should be refactored.</p>
<ul>
<li><code>BytesReader</code> =&gt; <code>input::Reader</code></li>
<li><code>OutputBytesReader</code> =&gt; <code>output::Reader</code></li>
</ul>
<p>Thanks to the change of IO trait split, we make <code>ObjectReader</code> implements all needed traits:</p>
<ul>
<li><code>futures::AsyncRead</code></li>
<li><code>futures::AsyncSeek</code></li>
<li><code>futures::Stream&lt;Item=io::Result&lt;Bytes&gt;&gt;</code></li>
</ul>
<p>Thus, we removed the <code>seekable_reader</code> API. They can be replaced by <code>range_reader</code>:</p>
<ul>
<li><code>o.seekable_reader</code> =&gt; <code>o.range_reader</code></li>
</ul>
<p>Most changes only happen inside. Users not using <code>opendal::raw::*</code> will not be affected.</p>
<p>Sorry for the inconvenience. I think those changes are required and make OpenDAL better! Welcome any comments at <a href="https://github.com/apache/incubator-opendal/discussions">Discussion</a>.</p>
<h2 id="upgrade-to-v021"><a href="#upgrade-to-v021">Upgrade to v0.21</a></h2>
<p>v0.21 is an internal refactor version of OpenDAL. In this version, we refactored our error handling and our <code>Accessor</code> APIs. Thanks to those internal changes, we added an object-level metadata cache, making it nearly zero cost to reuse existing metadata continuously.</p>
<p>Let’s start with our errors.</p>
<h3 id="error-handling"><a href="#error-handling">Error Handling</a></h3>
<p>As described in <a href="https://opendal.apache.org/rfcs/0977-refactor-error.html">RFC-0977: Refactor Error</a>, we refactor opendal error by a new error
called <a href="https://opendal.apache.org/opendal/struct.Error.html"><code>opendal::Error</code></a>.</p>
<p>This change will affect all APIs that are used to return <code>io::Error</code>.</p>
<p>To migrate this, please replace <code>std::io::Error</code> with <code>opendal::Error</code>:</p>
<div class="example-wrap"><pre class="language-diff"><code>- use std::io::Result;
+ use opendal::Result;
</code></pre></div>
<p>And the following error kinds should be updated:</p>
<ul>
<li><code>std::io::ErrorKind::NotFound</code> =&gt; <code>opendal::ErrorKind::ObjectNotFound</code></li>
<li><code>std::io::ErrorKind::PermissionDenied</code> =&gt; <code>opendal::ErrorKind::ObjectPermissionDenied</code></li>
</ul>
<p>And since v0.21, we will return errors <code>ObjectIsADirectory</code> and <code>ObjectNotADirectory</code> instead of <code>anyhow::Error</code>.</p>
<h3 id="accessor-api"><a href="#accessor-api">Accessor API</a></h3>
<p>In v0.21, we refactor the whole <code>Accessor</code>’s API:</p>
<div class="example-wrap"><pre class="language-diff"><code>- async fn write(&amp;self, path: &amp;str, args: OpWrite, r: BytesReader) -&gt; Result&lt;u64&gt;
+ async fn write(&amp;self, path: &amp;str, args: OpWrite, r: BytesReader) -&gt; Result&lt;RpWrite&gt;
</code></pre></div>
<p>Since v0.21, we will return a reply struct for different operations called <code>RpWrite</code> instead of an exact type. We can split OpenDAL’s public API and raw API with this change.</p>
<h3 id="objectlist-and-page"><a href="#objectlist-and-page">ObjectList and Page</a></h3>
<p>Since v0.21, <code>Accessor</code> will return <code>Pager</code> for <code>List</code>:</p>
<div class="example-wrap"><pre class="language-diff"><code>- async fn list(&amp;self, path: &amp;str, args: OpList) -&gt; Result&lt;ObjectStreamer&gt;
+ async fn list(&amp;self, path: &amp;str, args: OpList) -&gt; Result&lt;(RpList, output::Pager)&gt;
</code></pre></div>
<p>And <code>Object</code> will return an <code>ObjectLister</code> which is built upon <code>Page</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub async fn </span>list(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;ObjectLister&gt; { ... }</code></pre></div>
<p><code>ObjectLister</code> can be used as an object stream as before. It also provides the function <code>next_page</code> to get the underlying pages directly:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>ObjectLister {
    <span class="kw">pub async fn </span>next_page(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="prelude-ty">Option</span>&lt;Vec&lt;Object&gt;&gt;&gt;;
}</code></pre></div>
<h3 id="code-layout"><a href="#code-layout">Code Layout</a></h3>
<p>Since v0.21, we have categorized all APIs into <code>public</code> and <code>raw</code>.</p>
<p>Public APIs are exposed under <code>opendal::Xxx</code>; they are user-face APIs that are easy to use and understand.</p>
<p>Raw APIs are exposed under <code>opendal::raw::Xxx</code>; they are implementation details for underlying services and layers.</p>
<p>Please replace all usage of <code>opendal::io_util::*</code> and <code>opendal::http_util::*</code> to <code>opendal::raw::*</code> instead.</p>
<p>With this change, new users of OpenDAL maybe be it easier to get started.</p>
<h3 id="summary"><a href="#summary">Summary</a></h3>
<p>Sorry for introducing too much breaking change in a single version. This version can be a solid version for preparing OpenDAL v1.0.</p>
<h2 id="upgrade-to-v020"><a href="#upgrade-to-v020">Upgrade to v0.20</a></h2>
<p>v0.20 is a big release that we introduce a lot of performance related changes.</p>
<p>To make the best of information from <code>read</code> operation, we propose and implemented <a href="https://opendal.apache.org/rfcs/0926-object-reader.html">RFC-0926: Object Reader</a>. By this RFC, we can fetch content length from <code>ObjectReader</code> now!</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub struct </span>ObjectReader {
    inner: BytesReader
    meta: ObjectMetadata,
}

<span class="kw">impl </span>ObjectReader {
    <span class="kw">pub fn </span>content_length(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; u64 {}
    <span class="kw">pub fn </span>last_modified(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Option</span>&lt;OffsetDateTime&gt; {}
    <span class="kw">pub fn </span>etag(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Option</span>&lt;String&gt; {}
}</code></pre></div>
<p>To make this happen, we changed our <code>Accessor</code> API:</p>
<div class="example-wrap"><pre class="language-diff"><code>- async fn read(&amp;self, path: &amp;str, args: OpRead) -&gt; Result&lt;BytesReader&gt; {}
+ async fn read(&amp;self, path: &amp;str, args: OpRead) -&gt; Result&lt;ObjectReader&gt; {}
</code></pre></div>
<p>All layers should be updated to meet this change. Also, it’s required to return <code>content_length</code> while building <code>ObjectReader</code>. Please make sure the returning <code>ObjectMetadata</code> is used correctly.</p>
<h2 id="upgrade-to-v019"><a href="#upgrade-to-v019">Upgrade to v0.19</a></h2>
<p>OpenDAL deprecate some features:</p>
<ul>
<li><code>serde</code>: We will enable it by default.</li>
<li><code>layers-retry</code>: We will enable retry support by default.</li>
<li><code>layers-metadata-cache</code>: We will enable it by default.</li>
</ul>
<p>Deprecated types like <code>DirEntry</code> has been removed.</p>
<h2 id="upgrade-to-v018"><a href="#upgrade-to-v018">Upgrade to v0.18</a></h2>
<p>OpenDAL v0.18 introduces the following breaking changes:</p>
<ul>
<li>Deprecated feature flag <code>services-http</code> has been removed.</li>
<li>All <code>DirXxx</code> items have been renamed to <code>ObjectXxx</code> to make them more consistent.
<ul>
<li><code>DirEntry</code> -&gt; <code>Entry</code></li>
<li><code>DirStream</code> -&gt; <code>ObjectStream</code></li>
<li><code>DirStreamer</code> -&gt; <code>ObjectStream</code></li>
<li><code>DirIterate</code> -&gt; <code>ObjectIterate</code></li>
<li><code>DirIterator</code> -&gt; <code>ObjectIterator</code></li>
</ul>
</li>
</ul>
<p>Besides, we also make a big change to our <code>Entry</code> API. Since v0.18, we can fully reuse the metadata that fetched during <code>list</code>. Take <code>entry.content_length()</code> for example:</p>
<ul>
<li>If <code>content_length</code> is already known, we will return directly.</li>
<li>If not, we will check if the object entry is <code>complete</code>:
<ul>
<li>If <code>complete</code>, the entry already fetched all metadata that it could have, return directly.</li>
<li>If not, we will send a <code>stat</code> call to get the <code>metadata</code> and refresh our cache.</li>
</ul>
</li>
</ul>
<p>This change means:</p>
<ul>
<li>All API like <code>content_length</code> will be changed into async functions.</li>
<li><code>metadata</code> and <code>blocking_metadata</code> will not return errors anymore.</li>
<li>To retrieve the latest meta, please use <code>entry.into_object().metadata()</code> instead.</li>
</ul>
<h2 id="upgrade-to-v017"><a href="#upgrade-to-v017">Upgrade to v0.17</a></h2>
<p>OpenDAL v0.17 refactor the <code>Accessor</code> to make space for future features.</p>
<p>We move <code>path String</code> out of the <code>OpXxx</code> to function args so that we don’t need to clone twice.</p>
<div class="example-wrap"><pre class="language-diff"><code>- async fn read(&amp;self, args: OpRead) -&gt; Result&lt;BytesReader&gt;
+ async fn read(&amp;self, path: &amp;str, args: OpRead) -&gt; Result&lt;BytesReader&gt;
</code></pre></div>
<p>For more information about this change, please refer to <a href="https://opendal.apache.org/rfcs/0661-path-in-accessor.html">RFC-0661: Path In Accessor</a>.</p>
<p>And since OpenDAL v0.17, we will use <code>rustls</code> as default tls engine for our underlying http client. Since this release, we will not depend on <code>openssl</code> anymore.</p>
<h2 id="upgrade-to-v016"><a href="#upgrade-to-v016">Upgrade to v0.16</a></h2>
<p>OpenDAL v0.16 refactor the internal implementation of <code>http</code> service. Since v0.16, http service can be used directly without enabling <code>services-http</code> feature. Accompany by these changes, http service has the following breaking changes:</p>
<ul>
<li><code>services-http</code> feature has been deprecated. Enabling <code>services-http</code> is a no-op now.</li>
<li>http service is read only services and can’t be used to <code>list</code> or <code>write</code>.</li>
</ul>
<p>OpenDAL introduces a new layer <code>ImmutableIndexLayer</code> that can add <code>list</code> capability for services:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>opendal::layers::ImmutableIndexLayer;
<span class="kw">use </span>opendal::Operator;
<span class="kw">use </span>opendal::Scheme;

<span class="kw">async fn </span>main() {
    <span class="kw">let </span><span class="kw-2">mut </span>iil = ImmutableIndexLayer::default();

    <span class="kw">for </span>i <span class="kw">in </span>[<span class="string">&quot;file&quot;</span>, <span class="string">&quot;dir/&quot;</span>, <span class="string">&quot;dir/file&quot;</span>, <span class="string">&quot;dir_without_prefix/file&quot;</span>] {
        iil.insert(i.to_string())
    }

    <span class="kw">let </span>op = Operator::from_env(Scheme::Http)<span class="question-mark">?</span>.layer(iil);
}</code></pre></div>
<p>For more information about this change, please refer to <a href="https://opendal.apache.org/rfcs/0627-split-capabilities.html">RFC-0627: Split Capabilities</a>.</p>
<h2 id="upgrade-to-v014"><a href="#upgrade-to-v014">Upgrade to v0.14</a></h2>
<p>OpenDAL v0.14 removed all deprecated APIs in previous versions, including:</p>
<ul>
<li><code>Operator::with_backoff</code> in v0.13</li>
<li>All services <code>Builder::finish()</code> in v0.12</li>
<li>All services <code>Backend::build()</code> in v0.12</li>
</ul>
<p>Please visit related version’s upgrade guide for migration.</p>
<p>And in OpenDAL v0.14, we introduce a break change for <code>write</code> operations.</p>
<div class="example-wrap"><pre class="language-diff"><code>pub trait Accessor {
    - async fn write(&amp;self, args: &amp;OpWrite) -&gt; Result&lt;BytesWriter&gt; {}
    + async fn write(&amp;self, args: &amp;OpWrite, r: BytesReader) -&gt; Result&lt;u64&gt; {}
}
</code></pre></div>
<p>The following APIs have affected by this change:</p>
<ul>
<li><code>Object::write</code> now accept <code>impl Into&lt;Vec&lt;u8&gt;&gt;</code> instead of <code>AsRef&lt;&amp;[u8]&gt;</code></li>
<li><code>Object::writer</code> has been removed.</li>
<li><code>Object::write_from</code> has been added to support write from a reader.</li>
<li>All layers should be refactored to adapt new <code>Accessor</code> trait.</li>
</ul>
<p>For more information about this change, please refer to <a href="https://opendal.apache.org/rfcs/0554-write-refactor.html">RFC-0554: Write Refactor</a>.</p>
<h2 id="upgrade-to-v013"><a href="#upgrade-to-v013">Upgrade to v0.13</a></h2>
<p>OpenDAL deprecate <code>Operator::with_backoff</code> since v0.13.</p>
<p>Please use <a href="https://opendal.apache.org/opendal/layers/struct.RetryLayer.html"><code>RetryLayer</code></a> instead:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>anyhow::Result;
<span class="kw">use </span>backon::ExponentialBackoff;
<span class="kw">use </span>opendal::layers::RetryLayer;
<span class="kw">use </span>opendal::Operator;
<span class="kw">use </span>opendal::Scheme;

<span class="kw">let _ </span>= Operator::from_env(Scheme::Fs)
    .expect(<span class="string">&quot;must init&quot;</span>)
    .layer(RetryLayer::new(ExponentialBackoff::default()));</code></pre></div>
<h2 id="upgrade-to-v012"><a href="#upgrade-to-v012">Upgrade to v0.12</a></h2>
<p>OpenDAL introduces breaking changes for services initiation.</p>
<p>Since v0.12, <code>Operator::new</code> will accept <code>impl Accessor + 'static</code> instead of <code>Arc&lt;dyn Accessor&gt;</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>Operator {
    <span class="kw">pub fn </span>new(accessor: <span class="kw">impl </span>Accessor + <span class="lifetime">&#39;static</span>) -&gt; <span class="self">Self </span>{ .. }
}</code></pre></div>
<p>Every service’s <code>Builder</code> now have a <code>build()</code> API which can be run without async:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span><span class="kw-2">mut </span>builder = fs::Builder::default();
<span class="kw">let </span>op: Operator = Operator::new(builder.build()<span class="question-mark">?</span>);</code></pre></div>
<p>Along with these changes, <code>Operator::from_iter</code> and <code>Operator::from_env</code> now is a blocking API too.</p>
<p>For more information about this change, please refer to <a href="https://opendal.apache.org/rfcs/0501-new-builder.html">RFC-0501: New Builder</a>.</p>
<p>The following APIs have been deprecated:</p>
<ul>
<li>All services <code>Builder::finish()</code> (replaced by <code>Builder::build()</code>)</li>
<li>All services <code>Backend::build()</code> (replace by <code>Builder::default()</code>)</li>
</ul>
<p>The following APIs have been removed:</p>
<ul>
<li>public struct <code>Metadata</code> (deprecated in v0.8, replaced by <code>ObjectMetadata</code>)</li>
</ul>
<h2 id="upgrade-to-v08"><a href="#upgrade-to-v08">Upgrade to v0.8</a></h2>
<p>OpenDAL introduces a breaking change of <code>list</code> related operations in v0.8.</p>
<p>Since v0.8, <code>list</code> will return <code>DirStreamer</code> instead:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub trait </span>Accessor: Send + Sync + Debug {
    <span class="kw">async fn </span>list(<span class="kw-2">&amp;</span><span class="self">self</span>, args: <span class="kw-2">&amp;</span>OpList) -&gt; <span class="prelude-ty">Result</span>&lt;DirStreamer&gt; {}
}</code></pre></div>
<p><code>DirStreamer</code> streams <code>DirEntry</code> which carries <code>ObjectMode</code>, so that we don’t need an extra call to get object mode:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>DirEntry {
    <span class="kw">pub fn </span>mode(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; ObjectMode {
        <span class="self">self</span>.mode
    }
}</code></pre></div>
<p>And <code>DirEntry</code> can be converted into <code>Object</code> without overhead:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>o: Object = de.into()</code></pre></div>
<p>Since <code>v0.8</code>, <code>opendal::Metadata</code> has been deprecated by <code>opendal::ObjectMetadata</code>.</p>
<h2 id="upgrade-to-v07"><a href="#upgrade-to-v07">Upgrade to v0.7</a></h2>
<p>OpenDAL introduces a breaking change of <code>decompress_read</code> related in v0.7.</p>
<p>Since v0.7, <code>decompress_read</code> and <code>decompress_reader</code> will return <code>Ok(None)</code> while OpenDAL can’t detect the correct compress algorithm.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>Object {
    <span class="kw">pub async fn </span>decompress_read(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="prelude-ty">Option</span>&lt;Vec&lt;u8&gt;&gt;&gt; {}
    <span class="kw">pub async fn </span>decompress_reader(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="prelude-ty">Option</span>&lt;<span class="kw">impl </span>BytesRead&gt;&gt; {}
}</code></pre></div>
<p>So users should match and check the <code>None</code> case:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>bs = o.decompress_read().<span class="kw">await</span><span class="question-mark">?</span>.expect(<span class="string">&quot;must have valid compress algorithm&quot;</span>);</code></pre></div>
<h2 id="upgrade-to-v04"><a href="#upgrade-to-v04">Upgrade to v0.4</a></h2>
<p>OpenDAL introduces many breaking changes in v0.4.</p>
<h3 id="objectreader-is-not-asyncseek-anymore"><a href="#objectreader-is-not-asyncseek-anymore">Object::reader() is not <code>AsyncSeek</code> anymore</a></h3>
<p>Since v0.4, <code>Object::reader()</code> will return <code>impl BytesRead</code> instead of <code>Reader</code> that implements <code>AsyncRead</code> and <code>AsyncSeek</code>. Users who want <code>AsyncSeek</code> please wrapped with <code>opendal::io_util::seekable_read</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>opendal::io_util::seekable_read;

<span class="kw">let </span>o = op.object(<span class="string">&quot;test&quot;</span>);
<span class="kw">let </span><span class="kw-2">mut </span>r = seekable_read(<span class="kw-2">&amp;</span>o, <span class="number">10</span>..);
r.seek(SeekFrom::Current(<span class="number">10</span>)).<span class="kw">await</span><span class="question-mark">?</span>;
<span class="kw">let </span><span class="kw-2">mut </span>bs = <span class="macro">vec!</span>[<span class="number">0</span>;<span class="number">10</span>];
r.read(<span class="kw-2">&amp;mut </span>bs).<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<h3 id="use-rangebounds-instead"><a href="#use-rangebounds-instead">Use RangeBounds instead</a></h3>
<p>Since v0.4, the following APIs will be removed.</p>
<ul>
<li><code>Object::limited_reader(size: u64)</code></li>
<li><code>Object::offset_reader(offset: u64)</code></li>
<li><code>Object::range_reader(offset: u64, size: u64)</code></li>
</ul>
<p>Instead, OpenDAL is providing a more general <code>range_reader</code> powered by <code>RangeBounds</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub async fn </span>range_reader(<span class="kw-2">&amp;</span><span class="self">self</span>, range: <span class="kw">impl </span>RangeBounds&lt;u64&gt;) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="kw">impl </span>BytesRead&gt;</code></pre></div>
<p>Users can use their familiar rust range syntax:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>r = o.range_reader(<span class="number">1024</span>..<span class="number">2048</span>).<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<h3 id="return-ioresult-instead"><a href="#return-ioresult-instead">Return io::Result instead</a></h3>
<p>Since v0.4, all functions in OpenDAL will return <code>std::io::Result</code> instead.</p>
<p>Please check via <code>std::io::ErrorKind</code> directly:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::io::ErrorKind;

<span class="kw">if let </span><span class="prelude-val">Err</span>(e) = op.object(<span class="string">&quot;test_file&quot;</span>).metadata().<span class="kw">await </span>{
    <span class="kw">if </span>e.kind() == ErrorKind::NotFound {
        <span class="macro">println!</span>(<span class="string">&quot;object not exist&quot;</span>)
    }
}</code></pre></div>
<h3 id="removing-credential"><a href="#removing-credential">Removing Credential</a></h3>
<p>Since v0.4, <code>Credential</code> has been removed, please use the API provided by <code>Builder</code> directly.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>builder.access_key_id(<span class="string">&quot;access_key_id&quot;</span>);
builder.secret_access_key(<span class="string">&quot;secret_access_key&quot;</span>);</code></pre></div>
<h3 id="write-returns-byteswriter-instead"><a href="#write-returns-byteswriter-instead">Write returns <code>BytesWriter</code> instead</a></h3>
<p>Since v0.4, <code>Accessor::write</code> will return a <code>BytesWriter</code> instead accepting a <code>BoxedAsyncReader</code>.</p>
<p>Along with this change, the old <code>Writer</code> has been replaced by a new set of write functions:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub async fn </span>write(<span class="kw-2">&amp;</span><span class="self">self</span>, bs: <span class="kw">impl </span>AsRef&lt;[u8]&gt;) -&gt; <span class="prelude-ty">Result</span>&lt;()&gt; {}
<span class="kw">pub async fn </span>writer(<span class="kw-2">&amp;</span><span class="self">self</span>, size: u64) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="kw">impl </span>BytesWrite&gt; {}</code></pre></div>
<p>Users can write into an object more easily:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let _ </span>= op.object(<span class="string">&quot;path/to/file&quot;</span>).write(<span class="string">&quot;Hello, World!&quot;</span>).<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<h3 id="io_util-replaces-readers"><a href="#io_util-replaces-readers"><code>io_util</code> replaces <code>readers</code></a></h3>
<p>Since v0.4, mod <code>io_util</code> will replace <code>readers</code>. In <code>io_utils</code>, OpenDAL provides helpful functions like:</p>
<ul>
<li><code>into_reader</code>: Convert <code>BytesStream</code> into <code>BytesRead</code></li>
<li><code>into_sink</code>: Convert <code>BytesWrite</code> into <code>BytesSink</code></li>
<li><code>into_stream</code>: Convert <code>BytesRead</code> into <code>BytesStream</code></li>
<li><code>into_writer</code>: Convert <code>BytesSink</code> into <code>BytesWrite</code></li>
<li><code>observe_read</code>: Add callback for <code>BytesReader</code></li>
<li><code>observe_write</code>: Add callback for <code>BytesWrite</code></li>
</ul>
<h3 id="new-type-alias"><a href="#new-type-alias">New type alias</a></h3>
<p>For better naming, types that OpenDAL returns have been renamed:</p>
<ul>
<li><code>AsyncRead + Unpin + Send</code> =&gt; <code>BytesRead</code></li>
<li><code>BoxedAsyncReader</code> =&gt; <code>BytesReader</code></li>
<li><code>AsyncWrite + Unpin + Send</code> =&gt; <code>BytesWrite</code></li>
<li><code>BoxedAsyncWriter</code> =&gt; <code>BytesWriter</code></li>
<li><code>ObjectStream</code> =&gt; <code>ObjectStreamer</code></li>
</ul>
</div></details></section></div></main></body></html>